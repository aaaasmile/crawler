{{define "base"}}
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="./static/css/_card.scss?{{.Buildnr}}" rel="stylesheet">
    <link href="./static/css/_highcharts.scss?{{.Buildnr}}" rel="stylesheet">
    <link href="./static/css/_palette.scss?{{.Buildnr}}" rel="stylesheet">
    <link href="./static/css/_reboot.scss?{{.Buildnr}}" rel="stylesheet">
    <link href="./static/css/_root.scss?{{.Buildnr}}" rel="stylesheet">
    <link href="./static/css/_variables.scss?{{.Buildnr}}" rel="stylesheet">
    <script src="./static/lib/d3.v7.js?{{.Buildnr}}"></script>
    <title>SVG converter</title>
</head>

<body>
    <p id="title">Here will be changed</p>
    <div id="container"></div>
    <canvas id="mycanvas" width="408" height="200"></canvas>
    <button type="button" onclick="myfun()">Try It</button>
    <!-- <a href="" id="result"></a> -->
</body>
<script>
    function myfun2() {
        console.log('my fun is called')
        d3.select("p").style("color", "green");
        document.getElementById("title").innerHTML = "Title changed by javascript";
    }
</script>

<script type="module">
    // Declare the chart dimensions and margins.
    const width = 640;
    const height = 400;
    const marginTop = 20;
    const marginRight = 20;
    const marginBottom = 30;
    const marginLeft = 40;

    // Declare the x (horizontal position) scale.
    const x = d3.scaleUtc()
        .domain([new Date("2023-01-01"), new Date("2024-01-01")])
        .range([marginLeft, width - marginRight]);

    // Declare the y (vertical position) scale.
    const y = d3.scaleLinear()
        .domain([0, 100])
        .range([height - marginBottom, marginTop]);

    // Create the SVG container.
    const svg = d3.create("svg")
        .attr("width", width)
        .attr("height", height);

    // Add the x-axis.
    svg.append("g")
        .attr("transform", `translate(0,${height - marginBottom})`)
        .call(d3.axisBottom(x));

    // Add the y-axis.
    svg.append("g")
        .attr("transform", `translate(${marginLeft},0)`)
        .call(d3.axisLeft(y));

    // Append the SVG element.
    container.append(svg.node());

</script>

<script>
    function myfun() {
        console.log('Try to make canvas')
        //var el = d3.select("svg");
        // var canvas = document.createElement("canvas");
        // canvas.width = 640;
        // canvas.height = 400;
        var canvas = document.getElementById("mycanvas")

        // https://developer.mozilla.org/en/docs/HTML/Canvas/Drawing_DOM_objects_into_a_canvas

        // var svgMarkup = '<svg xmlns="http://www.w3.org/2000/svg"'
        //     // + ' class=""'
        //     // + ' width="40"'
        //     // + ' height="14"'
        //     + '>'
        //     + '<ellipse cx="200" cy="80" rx="100" ry="50" style="fill:yellow;stroke:purple;stroke-width:2" />'
        //     + '</svg>';
        var svgMarkup = '{{.SvgData}}';
        console.log('svg markup is ', svgMarkup);
        var ctx = canvas.getContext("2d");
        var DOMURL = window.URL || window.webkitURL || window;
        var img = new Image();
        var svgCanv = new Blob([svgMarkup], { type: "image/svg+xml;charset=utf-8" });
        var url = DOMURL.createObjectURL(svgCanv);
        img.onload = function () {
            ctx.drawImage(img, 0, 0, 400, 140);
            console.log('Image ok');
            DOMURL.revokeObjectURL(url);
            console.log('canvas data url:', canvas.toDataURL());
            // let link = document.getElementById("result");
            // link.setAttribute("href", canvas.toDataURL());
            // link.innerHTML = "link to download";
        };
        console.log('url to image is ', url)
        img.src = url;
        //img.src = svgMarkup;
        //canvas.getContext("2d").drawImage(img,0,0);

        console.log('Now change also the title...')
        //document.getElementById("title").innerHTML = '{{.SvgData}}';
    }
</script>

</html>

{{end}}